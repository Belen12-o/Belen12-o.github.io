<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rompecabezas Flip</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #f29696;
      font-family: 'Montserrat', sans-serif;
    }

    #container {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      perspective: 1000px;
      min-height: 100vh;
    }

    .card {
      width: 90vw;
      height: 90vw;
      max-width: 370px;
      max-height: 370px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1s ease-in-out;
    }

    .flipped {
      transform: rotateY(180deg);
    }

    .face {
      width: 100%;
      height: 100%;
      position: absolute;
      backface-visibility: hidden;
      border-radius: 10px;
      overflow: hidden;
    }

    .front {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 2px;
      background: #000;
    }

    .piece {
      width: 100%;
      height: 100%;
      background-image: url('./photos/picture1.jpg');
      background-size: 400% 400%;
      cursor: pointer;
    }

    .back {
      background: #ffe4e1;
      transform: rotateY(180deg);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
      font-size: 16px;
      text-align: justify;
    }

    #message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      display: none;
    }
  </style>
</head>
<body>

  <div id="message">Â¡Bien hecho! ðŸ’–</div>

  <div id="container">
    <div id="card" class="card">
      <div class="face front" id="puzzle"></div>
      <div class="face back">
        Esta es tu cartita secreta al completar el rompecabezas. Â¡Te amo! ðŸ’Œ
      </div>
    </div>
  </div>

  <script>
    const puzzle = document.getElementById("puzzle");
    const card = document.getElementById("card");
    const message = document.getElementById("message");

    const gridSize = 4;
    const positions = [];

    for (let y = 0; y < gridSize; y++) {
      for (let x = 0; x < gridSize; x++) {
        positions.push({ x: `${-x * 100}%`, y: `${-y * 100}%` });
      }
    }

    const correctOrder = [...positions];
    const shuffled = [...positions];

    // Fisher-Yates shuffle
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }

    shuffled.forEach((pos, i) => {
      const piece = document.createElement("div");
      piece.className = "piece";
      piece.style.backgroundPosition = `${pos.x} ${pos.y}`;
      piece.dataset.correct = `${correctOrder[i].x},${correctOrder[i].y}`;
      piece.dataset.current = `${pos.x},${pos.y}`;
      piece.draggable = true;
      puzzle.appendChild(piece);
    });

    let dragged;
    puzzle.addEventListener("dragstart", e => {
      dragged = e.target;
    });

    puzzle.addEventListener("dragover", e => {
      e.preventDefault();
    });

    puzzle.addEventListener("drop", e => {
      if (e.target.classList.contains("piece") && e.target !== dragged) {
        swapPieces(dragged, e.target);
      }
    });

    let firstTap = null;
    puzzle.addEventListener("pointerdown", e => {
      if (!e.target.classList.contains("piece")) return;
      if (!firstTap) {
        firstTap = e.target;
        firstTap.style.outline = "3px solid #f06292";
      } else {
        if (e.target !== firstTap) {
          swapPieces(firstTap, e.target);
        }
        firstTap.style.outline = "none";
        firstTap = null;
      }
    });

    function swapPieces(a, b) {
      const tempPos = a.style.backgroundPosition;
      const tempData = a.dataset.current;

      a.style.backgroundPosition = b.style.backgroundPosition;
      a.dataset.current = b.dataset.current;

      b.style.backgroundPosition = tempPos;
      b.dataset.current = tempData;

      checkCompletion();
    }

    function checkCompletion() {
      const pieces = document.querySelectorAll(".piece");
      const allCorrect = [...pieces].every(p => p.dataset.current === p.dataset.correct);
      if (allCorrect) {
        message.style.display = "block";
        puzzle.style.pointerEvents = "none";

        setTimeout(() => {
          card.classList.add("flipped");
          message.style.display = "none";
        }, 1500);
      }
    }
  </script>
</body>
</html>
